<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One Control | Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--white); padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 95%; max-width: 800px; border-top: 6px solid var(--primary); }
        .hidden { display: none !important; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; text-align: right; }
        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; width: 100%; }
        .btn-login { background: var(--accent); color: white; font-size: 17px; }
        .btn-save { background: var(--success); color: white; margin-top: 10px; }
        .btn-logout { background: #7f8c8d; color: white; width: auto; float: left; margin-bottom: 20px; padding: 8px 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #f8f9fa; color: var(--primary); }
        .status-active { color: var(--success); font-weight: bold; }
    </style>
</head>
<body>
    <div id="loginSection" class="container" style="max-width: 400px;">
        <h1 style="text-align:center;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
        <input type="text" id="userInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-login" onclick="validateLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>

    <div id="adminPanel" class="container hidden">
        <button class="btn-logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        <div style="clear: both;"></div>
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</h2>
        <div style="background:#f9f9f9; padding:15px; border-radius:10px; border:1px solid #eee;">
            <input type="text" id="compName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©">
            <input type="text" id="compUser" placeholder="ÙŠÙˆØ²Ø± Ù†ÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©">
            <input type="password" id="compPass" placeholder="Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø´Ø±ÙƒØ©">
            <select id="compPlan">
                <option value="0">Ø­Ø¯Ø¯ Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</option>
                <option value="30">30 ÙŠÙˆÙ…</option>
                <option value="90">90 ÙŠÙˆÙ…</option>
                <option value="365">Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</option>
            </select>
            <button class="btn-save" onclick="saveCompany()">ØªÙØ¹ÙŠÙ„ ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</button>
        </div>
        <table>
            <thead><tr><th>Ø§Ù„Ø´Ø±ÙƒØ©</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody id="companyTableBody"></tbody>
        </table>
    </div>

    <script>
        const API_URL = 'https://sheetdb.io/api/v1/xsp51h4e6tvnw'
        let companies = JSON.parse(localStorage.getItem('n1_companies')) || []

        async function syncCloud() {
            try {
                const r = await fetch(API_URL); const d = await r.json()
                if(d.length > 0) {
                    companies = d.filter(i => i.user && i.pass)
                    localStorage.setItem('n1_companies', JSON.stringify(companies))
                    if(!document.getElementById('adminPanel').classList.contains('hidden')) renderTable()
                }
            } catch(e) {}
        }
        window.onload = syncCloud

        function validateLogin() {
            const u = document.getElementById('userInput').value, p = document.getElementById('passInput').value
            if (u === "admin" && p === "n1_2026") { renderTable(); showPanel('adminPanel'); return }
            const f = companies.find(c => c.user === u && c.pass === p)
            if (f) {
                if(new Date() > new Date(f.expiry)) return alert("Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠ")
                sessionStorage.setItem('currentActiveCompanyName', f.name)
                sessionStorage.setItem('currentActiveUser', f.user)
                window.location.href = "company_dashboard.html"
            } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©") }
        }

        async function saveCompany() {
            const n = document.getElementById('compName').value, u = document.getElementById('compUser').value, p = document.getElementById('compPass').value, d = parseInt(document.getElementById('compPlan').value)
            if(!n || !u || !p || d === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
            let ex = new Date(); ex.setDate(ex.getDate() + d)
            const data = { id: Date.now(), name: n, user: u, pass: p, expiry: ex.toISOString() }
            try {
                await fetch(API_URL, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({data: [data]}) })
                companies.push(data); localStorage.setItem('n1_companies', JSON.stringify(companies))
                alert("ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ ğŸ˜Š"); renderTable()
            } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©") }
        }

        function renderTable() {
            const b = document.getElementById('companyTableBody'); b.innerHTML = ""
            companies.forEach(c => {
                b.innerHTML += `<tr><td>${c.name}</td><td>${c.user}</td><td>${new Date(c.expiry).toLocaleDateString()}</td><td class="status-active">Ù†Ø´Ø·</td><td><button onclick="deleteComp(${c.id})" style="background:red; color:white; padding:5px; border-radius:5px; width:auto;">Ø­Ø°Ù</button></td></tr>`
            })
        }
        function deleteComp(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙƒØ©ØŸ")) { companies = companies.filter(c => c.id !== id); localStorage.setItem('n1_companies', JSON.stringify(companies)); renderTable() } }
        function showPanel(id) { document.getElementById('loginSection').classList.add('hidden'); document.getElementById(id).classList.remove('hidden') }
        function logout() { sessionStorage.clear(); location.reload() }
    </script>
</body>
</html>
